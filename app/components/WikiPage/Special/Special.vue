<template>
  <div id="special-page">
    <component :is="getComponentForSpecialPage()" :site="site" :params="page.params" v-if="!qpPages.includes(specialPage.toLowerCase())">
    </component>
    <WikiPageSpecialQPBased :type="specialPage" v-else />
  </div>
</template>

<script setup lang="ts">
import { 
  WikiPageSpecialAllPages, 
  WikiPageSpecialRandom, 
  WikiPageSpecialRandomPlus, 
  WikiPageSpecialRandomRoot, 
  WikiPageSpecialLog, 
  WikiPageSpecialRecentChanges, 
  WikiPageSpecialSPList 
} from '#components';
import type { MiraiWiki } from '~~/shared/types/miraiwiki';

const { site, page } = defineProps<{
  site: string,
  page: MiraiWiki.absymal
}>();

const specialPage = removePrefix(page.page, "Special:").trim()


if (specialPage === "ApiSandbox") {
  await navigateTo(`https://${site}.fandom.com/wiki/Special:ApiSandbox`, { external: true });
}

useSheets().addSheet("modules=skin.fandomdesktop.SpecialPageGlobal.css");

/// meaning query pages are case-insensitive
const qpPages = [
  'allinfoboxes',
  'ancientpages',
  'brokenredirects',
  'deadendpages',
  'disambiguationpagelinks',
  'disambiguationpages',
  'doubleredirects',
  'fewestrevisions',
  'listduplicatedfiles',
  'listredirects',
  'lonelypages',
  'longpages',
  'mediastatistics',
  'mostcategories',
  'mostimages',
  'mostinterwikis',
  'mostlinked',
  'mostlinkedcategories',
  'mostlinkedtemplates',
  'mostrevisions',
  'nonportableinfoboxes',
  'shortpages',
  'uncategorizedcategories',
  'uncategorizedimages',
  'uncategorizedpages',
  'uncategorizedtemplates',
  'unorganizedtemplates',
  'unusedcategories',
  'unusedimages',
  'unusedtemplates',
  'unwatchedpages',
  'wantedcategories',
  'wantedfiles',
  'wantedpages',
  'wantedtemplates',
  'withoutimages',
  'withoutinterwiki'
]

function getComponentForSpecialPage() {
  return specialPage === "AllPages" ? WikiPageSpecialAllPages :
    specialPage === "SpecialPages" ? WikiPageSpecialSPList :
    specialPage === "Random" ? WikiPageSpecialRandom :
    specialPage === "RandomRedirect" ? WikiPageSpecialRandomPlus :
    specialPage === "RandomRootpage" ? WikiPageSpecialRandomRoot :
    specialPage === "Log" ? WikiPageSpecialLog :
    specialPage === "RecentChanges" ? WikiPageSpecialRecentChanges :
    'div';
}
</script>

<style>
#special-page {
  --ui-bg: var(--widget-primary-background-color);
  --ui-bg-muted: var(--widget-frame-background-color);
  --ui-bg-elevated: var(--widget-frame-background-color);
}
</style>